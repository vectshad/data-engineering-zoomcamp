id: process_yellow_2021_03
namespace: zoomcamp
description: |
  Process Yellow taxi data for March 2021.
  This flow will process a single month and count rows.

tasks:
  - id: process_march_2021
    type: io.kestra.plugin.core.flow.Subflow
    namespace: zoomcamp
    flowId: 04_postgres_taxi
    inputs:
      taxi: yellow
      year: "2021"
      month: "03"

  - id: count_rows
    type: io.kestra.plugin.jdbc.postgresql.Query
    fetchType: FETCH
    sql: |
      SELECT COUNT(*) as total_rows 
      FROM public.yellow_tripdata 
      WHERE filename = 'yellow_tripdata_2021-03.csv';

pluginDefaults:
  - type: io.kestra.plugin.jdbc.postgresql
    values:
      url: jdbc:postgresql://pgdatabase:5432/ny_taxi
      username: root
      password: root
